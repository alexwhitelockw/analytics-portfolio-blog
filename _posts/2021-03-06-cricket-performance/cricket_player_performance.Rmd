---
title: "Cricket Performance and Regression to the Mean"
categories:
  - cricket
  - regression
description: |
  In this post I explore regression to the mean in the context of cricket performance.
author:
  - name: Alex Wainwright
    url: https://github.com/alexwhitelockw
date: 03-14-2021
output:
  distill::distill_article:
    self_contained: false
---

# Overview

After watching the Australian Big Bash League (BBL), I've noticed that evaluations of player performances can be particularly critical. These critiques commonly directed towards a player whose performance is in a *slump*. Despite these negative appraisals, a player who may have experienced a bad season may improve in the season that follows. This is known as regression to the mean and is common to many walks of life, and is caused by imprecise measurements. In the context of cricket, a player's performance is made up of both their true ability and random variation. Put differently, whilst a player has the skills to perform well, we cannot discount the role that luck plays (e.g., weather conditions). Therefore, predictions of future performances are unlikely to be perfect.

In this post, we will be exploring regression to the mean in the context of cricket player performance in the BBL (2011/12 Season to 2020/21 Season). All analyses undertaken used a dataset from [Cricsheet](https://cricsheet.org).

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(data.table)
library(ggplot2)
library(rstanarm)

bbl_data <-
  fread("all_matches.csv")

bbl_data[, over := as.numeric(stringr::str_extract(ball, "[0-9]{1,2}"))]
bbl_data[, over_ball := stringr::str_extract(ball, "\\.[0-9]{1,2}")]
bbl_data[, over_ball := as.numeric(stringr::str_remove(over_ball, "\\."))]

```

# Batsman Performance

Let's start out with calculating the average runs per season.

```{r avgRuns, layout="l-body-outset"}

batting_scores_10_seasons <-
  bbl_data[, .(sum_runs = sum(runs_off_bat)),
           by = c("match_id", "season", "start_date", "striker")]

avg_run_rate_10_seasons <-
  batting_scores_10_seasons[, .(avg_run_rate = round(mean(sum_runs),2)),
                            by = c("striker", "season")]

avg_run_rate_10_seasons <-
  dcast(
    avg_run_rate_10_seasons,
    striker ~ season,
    value.var = "avg_run_rate"
    )

rmarkdown::paged_table(avg_run_rate_10_seasons)

```

As can be seen, there are `r nrow(avg_run_rate_10_seasons)` rows in the data with many blank values, as players have not played every season. For our purpose, we are going to look at those players who played three seasons (2018/19, 2019/20, and 2020/21). If any of these three seasons contained blank values, we dropped the player.


```{r topStrikerTable}
top_strikers_2019 <-
  avg_run_rate_10_seasons[!is.na(`2018/19`) & !is.na(`2019/20`) & !is.na(`2020/21`), 
                          .(striker, `2018/19`, `2019/20`, `2020/21`)]

setorder(top_strikers_2019, -`2019/20`)

top_10_strikers_2019 <-
  head(top_strikers_2019, 10)

knitr::kable(top_10_strikers_2019,
             digits = 2,
             caption="Average runs of those batsmen who played in the 2018/19, 2019/20, and 2020/21 BBL seasons (limited to top 10). Batsmen are in descending order based on the 2019/20 season. It can be seen that Wade attained the highest average run rate in the 2019/20 season, followed by Stoinis and Finch. In most cases, performances in the adjacent seasons were below that attained in the 2019/20 season.")

```

From Table \@ref(tab:topStrikerTable), we can see those batsmen who performed well in the 2019/20 season. For most of these batsmen, performances in seasons adjacent to that attained in 2019/20 were not commensurate. For example, Webster scored an average of `r round(top_10_strikers_2019[striker == "BJ Webster", "2019/20"],2)` in the 2019/20 season, whilst only averaged `r round(top_10_strikers_2019[striker == "BJ Webster", "2018/19"],2)` and `r round(top_10_strikers_2019[striker == "BJ Webster", "2020/21"],2)` runs in the 2018/2019 and 2020/21 seasons, respectively.

We can also look at the average run rate change across these top ten players:

- In the 2018/19 season, the top ten players (Table \@ref(tab:topStrikerTable)) averaged `r round(abs(apply(top_10_strikers_2019[,2] - top_10_strikers_2019[,3], 2, mean)),2)` fewer runs compared to 2019/20.

- In the 2020/21 season, the top ten players (Table \@ref(tab:topStrikerTable)) averaged
`r round(abs(apply(top_10_strikers_2019[,4] - top_10_strikers_2019[,3], 2, mean)),2)` fewer runs compared to 2019/20.

We can take this analysis a step further by calculating correlations between the season performances. From this point onward, the analysis will use those `r nrow(top_strikers_2019)` players without missing values across the three seasons (2018/19, 2019/20, and 2020/21).

When we correlated the performance (average runs) of players in 2018/19, we get a value of `r round(cor(top_strikers_2019$'2018/19', top_strikers_2019$'2019/20'), 2)`. As for 2020/21, the correlation value is `r round(cor(top_strikers_2019$'2019/20', top_strikers_2019$'2020/21'), 2)`. In both cases, the correlations are positive and large, yet they are not perfect. We can say that past performance is a good indicator of future performance, yet predictions will not be 100% accurate.

A simple linear model now follows, wherein we regress performance in the 2019/20 season on the prior season's performance (2018/19).

```{r predPerf2019, echo=TRUE, warning=F}

season_1920_model <-
  stan_glm(`2019/20` ~ `2018/19`,
           data = top_strikers_2019,
           refresh = 0)

knitr::kable(
  broom.mixed::tidy(season_1920_model),
  digits = 2,
  col.names = c("Term", "Estimate", "Standard Error"),
  caption = "Point estimates from the regression of 2019/20 performance on 2018/19 performance.")

```

Let's demonstrate with the prediction of the 2019/20 performance presented in Table \@ref(tab:predPerf2019) (Figure \@ref(fig:plot1920Model) plots the regression model of 2019/20 season performance on to 2018/19 season performance along with the regression line uncertainty):

- Based on the model, if a player averaged 0 runs in the 2018/19 season, they are predicted to achieve an average run rate of `r round(coef(season_1920_model)[1],2)` in the 2019/20 season.

- Each average run rate that is greater than 0 in the 2018/19 season results in an expected average run rate that is `r round(coef(season_1920_model)[2],2)` higher than `r round(coef(season_1920_model)[1],2)`. As this coefficient is below 1, it is indicative of batting performance regressing to the mean. For example, if a player averaged 25 runs in 2018/19, they are predicted to average `r 3.62 + .77*25` runs in the 2019/20 season. In other words, whilst a player may be a highly skilled batsman, there is a degree of luck from match-to-match (e.g., tiredness or playing the wrong shot).

- The residual standard deviation of the model is `r round(sigma(season_1920_model))`. This means that our model predicts the average run rate in 2019/20 to within `r round(sigma(season_1920_model))` runs. So while previous performance may be important in future performance, it isn't enough to make a perfect prediction.

```{r plot1920Model, fig.align="centre", fig.cap="Point estimate line for the regression of 2019/20 season performance onto the 2018/19 season performance. A sample of 500 coefficient values for the intercept and slope are also plotted to show the uncertainty in the estimates.", layout="l-body-outset"}

set.seed(13032021)

season_1920_sims <-
  as.matrix(season_1920_model)

season_1920_sims <-
  season_1920_sims[sample(nrow(season_1920_sims), 500), 1:2]

ggplot(top_strikers_2019, aes(x = `2018/19`, y = `2019/20`)) +
  geom_abline(
    intercept = season_1920_sims[,1], 
    slope = season_1920_sims[,2],
    alpha = .4,
    colour = "lightgrey"
    ) +
  geom_abline(
    intercept = coef(season_1920_model)[1], 
    slope = coef(season_1920_model)[2]
    ) +
  geom_point() +
  labs(
    x = "Average Runs for the 2018/19 Season",
    y = "Average Runs for the 2019/20 Season"
  ) +
  theme(
    panel.background = element_rect(
      colour = "black",
      fill = "white"
    )
  )
```

# Summary

I've attempted to illustrate regression to the mean in cricket performances. As shown above, even though a player may perform well in a given year, this does not mean that future performances will be consistent. This is because performances are an imperfect measure of ability on account of random variations (i.e., a player may have had a lucky season).